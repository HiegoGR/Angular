<!-- Título da página -->
<h1>Cadastro de Endereço</h1>

<div class="page">
  <!-- ✅ Formulário (ngForm) -->
  <form class="card" #formulario="ngForm" (ngSubmit)="salvar()">
    <h2 class="card-title">Novo endereço</h2>

    <!-- Linha do CEP + botão pesquisar -->
    <div class="cep-row">
      <!-- Campo de CEP (obrigatório) -->
      <label class="field">
        <span>CEP</span>
        <input
          type="text"
          name="cep"
          [(ngModel)]="endereco.cep"
          placeholder="Ex: 01001000"
          required
        />
      </label>

      <!-- Botão que consulta o ViaCEP e preenche os campos -->
      <button
        type="button"
        (click)="pesquisarCep()"
        [disabled]="carregandoCep"
      >
        {{ carregandoCep ? 'Pesquisando...' : 'Pesquisar' }}
      </button>
    </div>

    <!-- Mensagem de erro do CEP (se existir) -->
     @if(erroCep){
        <p class="error">{{ erroCep }}</p>
     }

    <!-- Campos do endereço -->
    <div class="form">
      <!-- Logradouro (obrigatório) -->
      <label class="field">
        <span>Logradouro</span>
        <input
          type="text"
          name="logradouro"
          [(ngModel)]="endereco.logradouro"
          required
        />
      </label>

      <!-- Complemento (opcional) -->
      <label class="field">
        <span>Complemento</span>
        <input
          type="text"
          name="complemento"
          [(ngModel)]="endereco.complemento"
        />
      </label>

      <!-- Bairro (obrigatório) -->
      <label class="field">
        <span>Bairro</span>
        <input
          type="text"
          name="bairro"
          [(ngModel)]="endereco.bairro"
          required
        />
      </label>

      <!-- Cidade (localidade) (obrigatório) -->
      <label class="field">
        <span>Localidade (Cidade)</span>
        <input
          type="text"
          name="localidade"
          [(ngModel)]="endereco.localidade"
          required
        />
      </label>

      <!-- UF (obrigatório) -->
      <label class="field">
        <span>UF</span>
        <input
          type="text"
          name="uf"
          [(ngModel)]="endereco.uf"
          required
        />
      </label>

      <!-- Estado (obrigatório) -->
      <label class="field">
        <span>Estado</span>
        <input
          type="text"
          name="estado"
          [(ngModel)]="endereco.estado"
          required
        />
      </label>
    </div>

    <!-- Botões de ação -->
    <div class="actions">
      <!-- ✅ Submit do form (só habilita se o form for válido) -->
      <button type="submit" [disabled]="!formulario.valid">
        Salvar
      </button>

      <!-- Limpar formulário -->
      <button type="button" (click)="limpar()">
        Limpar
      </button>
    </div>

    <!-- ✅ Mensagem opcional se tentar salvar com campos faltando -->
     @if(formulario.submitted && !formulario.valid){
      <p class="error">
        Preencha todos os campos obrigatórios antes de salvar.
      </p>
     }

  </form> <!--  fechamento do form -->

      <!-- ✅ Listagem (fica FORA do form) -->
    <section class="card" style="margin-top: 16px;">
      <h2 class="card-title">Endereços cadastrados</h2>

      <!-- Se tiver endereços, mostra tabela -->
      @if (enderecos.length > 0) {
        <table class="table">
          <thead>
            <tr>
              <th>ID</th>
              <th>CEP</th>
              <th>Logradouro</th>
              <th>Bairro</th>
              <th>Cidade</th>
              <th>UF</th>
              <th>Estado</th>
              <th>Ações</th>
            </tr>
          </thead>

         <tbody>
<!--          
exemplo de com usar sintaxy nova do ngFor
<h3>Produtos</h3>
@for (p of produtos; track p.id) {
  <p>{{ p.nome }}</p>
} @empty {
  <p>Nenhum produto encontrado.</p>
}

@for (p of produtos; track p.id; let i = $index) {
  <p>{{ i + 1 }}: {{ p.nome }}</p>
}
 -->

          @for (e of enderecos; track e.id) {
            <tr>
              <td>{{ e.id }}</td>
              <td>{{ e.cep }}</td>
              <td>{{ e.logradouro }}</td>
              <td>{{ e.bairro }}</td>
              <td>{{ e.localidade }}</td>
              <td>{{ e.uf }}</td>
              <td>{{ e.estado }}</td>
              <td class="row-actions">
                <button type="button" (click)="editar(e)">Editar</button>
                <button type="button" (click)="remover(e.id)">Excluir</button>
              </td>
            </tr>
          } @empty {
            <tr>
              <td colspan="8" class="muted">Nenhum endereço cadastrado ainda.</td>
            </tr>
          }
         </tbody>

        </table>
      }
      @else {
        <p class="muted">Nenhum endereço cadastrado ainda.</p>
      }

    </section>

</div>
